import fs from "fs";
import {ManifestPath, VersionArgNumber, ReadmeDistPath, UnityVersionMarker, PackageVersionMarker, ReadmeOutPaths} from "./Config.js";

function getUnityVersion(){
    const versionMarker = process.argv.find(u => u == VersionArgNumber);
    const unityVersionIndex = process.argv.indexOf(versionMarker) + 1;
    return process.argv[unityVersionIndex]
}

function getPackageVersion(){
    const rawManifest = fs.readFileSync(ManifestPath);
    const manifest = JSON.parse(rawManifest.toString().trim());
    return manifest.version;
}

function buildReadme(){
    const readmeDist = fs.readFileSync(ReadmeDistPath);
    const unityVersion = getUnityVersion();
    let packageVersion = getPackageVersion();

    if (packageVersion.split('-').length > 1){
        packageVersion = packageVersion.replace('-', '--');
    }

    const proceedReadme = readmeDist.toString()
        .replace(UnityVersionMarker, unityVersion)
        .replace(PackageVersionMarker, packageVersion);

    ReadmeOutPaths.forEach(str => {
        fs.writeFileSync(str, proceedReadme);
    });
}

buildReadme();